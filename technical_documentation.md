# التوثيق التقني لنظام الزيارات الصفية

## التكنولوجيا المستخدمة

### لغات البرمجة وتقنيات الواجهة
- **لغة PHP**: الإصدار 7.4 أو أحدث لبرمجة الخادم (Server-side)
- **SQL**: لاستعلامات قاعدة البيانات
- **HTML5**: لبناء هيكل صفحات الويب
- **CSS3**: لتنسيق وتصميم الواجهة
- **JavaScript**: للوظائف التفاعلية في جانب العميل (Client-side)

### أطر العمل والمكتبات
- **Tailwind CSS**: إطار عمل CSS لتصميم واجهة المستخدم بنظام الوحدات (Utility-first)
- **Alpine.js**: إطار عمل JavaScript خفيف للتفاعلية في واجهة المستخدم
- **Google Fonts**: استخدام خط Cairo للواجهة العربية

### قاعدة البيانات
- **MySQL**: الإصدار 5.7 أو أحدث
- **PDO**: واجهة برمجة للاتصال بقاعدة البيانات بطريقة آمنة

### بيئة التشغيل
- **خادم الويب**: Apache أو Nginx
- **PHP-FPM**: لمعالجة طلبات PHP بكفاءة عالية (اختياري)
- **HTTPS**: لتأمين الاتصال بين المستخدم والخادم

## هيكل النظام

### نموذج بنية التطبيق
يعتمد النظام على النمط التقليدي لبنية ويب PHP مع بعض مبادئ نمط MVC (Model-View-Controller):
- **نموذج البيانات**: ملفات قاعدة البيانات والوظائف المرتبطة بها
- **العرض**: ملفات التصميم والواجهة للمستخدم
- **المتحكم**: ملفات معالجة الطلبات وتنفيذ العمليات

### هيكل المجلدات
```
classvisit/
├── api/                  # واجهات برمجة التطبيق (API)
│   ├── get_grades.php
│   ├── get_previous_visits.php
│   ├── get_recommendations.php
│   ├── get_sections.php
│   ├── get_subjects.php
│   ├── get_teachers.php
│   └── get_visitor_name.php
├── assets/               # الأصول الثابتة
│   ├── css/              # ملفات التنسيق
│   └── js/               # ملفات جافا سكريبت
├── coc/                  # وثائق قواعد السلوك (Code of Conduct)
├── database/             # ملفات قاعدة البيانات
├── includes/             # الملفات المشتركة
│   ├── db_connection.php # الاتصال بقاعدة البيانات
│   ├── functions.php     # الوظائف المشتركة
│   ├── header.php        # رأس الصفحات
│   └── footer.php        # تذييل الصفحات
├── uploads/              # المرفقات المرفوعة
│   └── logos/            # شعارات المدارس
└── [ملفات الصفحات الرئيسية.php]
```

### هيكل قاعدة البيانات

#### الجداول الرئيسية
1. **`educational_levels`**: المراحل التعليمية
2. **`evaluation_domains`**: مجالات التقييم
3. **`evaluation_indicators`**: مؤشرات التقييم
4. **`grades`**: الصفوف الدراسية
5. **`recommendations`**: التوصيات
6. **`schools`**: المدارس
7. **`sections`**: الشعب الدراسية
8. **`subjects`**: المواد الدراسية
9. **`teachers`**: المعلمون
10. **`teacher_subjects`**: العلاقة بين المعلمين والمواد
11. **`visitor_types`**: أنواع الزائرين
12. **`visits`**: الزيارات الصفية
13. **`visit_evaluations`**: تقييمات الزيارات

#### العلاقات بين الجداول
![مخطط قاعدة البيانات العلائقية](https://example.com/database-schema.png)

- علاقة **1:N** بين المراحل التعليمية والصفوف الدراسية
- علاقة **1:N** بين الصفوف الدراسية والشعب
- علاقة **1:N** بين مجالات التقييم ومؤشرات التقييم
- علاقة **1:N** بين مؤشرات التقييم والتوصيات
- علاقة **1:N** بين المدارس والمعلمين
- علاقة **M:N** بين المعلمين والمواد الدراسية (من خلال جدول teacher_subjects)
- علاقة **1:N** بين المعلمين والزيارات
- علاقة **1:N** بين أنواع الزائرين والزيارات
- علاقة **1:N** بين الزيارات وتقييمات الزيارات

## آلية عمل النظام

### تدفق البيانات
1. **التسجيل وإدارة المستخدمين**:
   - إنشاء حسابات للمستخدمين (مدراء، نواب، منسقين، موجهين)
   - تحديد صلاحيات الوصول حسب نوع المستخدم

2. **إعداد البيانات الأساسية**:
   - إضافة المدارس والمراحل التعليمية والصفوف والشعب
   - إضافة المواد الدراسية وربطها بالمعلمين
   - تعريف مجالات ومؤشرات التقييم والتوصيات المرتبطة بها

3. **إدارة الزيارات الصفية**:
   - إنشاء زيارة جديدة وتحديد بياناتها الأساسية
   - اختيار المعلم والصف والشعبة والمادة الدراسية
   - تقييم المؤشرات وإضافة الملاحظات والتوصيات
   - حفظ وطباعة تقرير الزيارة

4. **استخراج التقارير والإحصائيات**:
   - عرض تقارير أداء المعلمين والصفوف
   - تحديد الاحتياجات التدريبية فردياً وجماعياً
   - تحليل البيانات لاستخراج المؤشرات والاتجاهات

### نموذج المعالجة
1. **استلام الطلب**: معالجة طلب HTTP من المستخدم
2. **التحقق من الصلاحيات**: التأكد من توفر صلاحيات الوصول
3. **معالجة البيانات**: تنفيذ العمليات المطلوبة (استعلام، إضافة، تعديل، حذف)
4. **عرض النتائج**: إرجاع البيانات وعرضها في واجهة المستخدم

### الأمان والحماية
1. **حماية الاستعلامات**: استخدام الاستعلامات المحضرة (Prepared Statements) عبر PDO
2. **تحقق من المدخلات**: تنظيف وفلترة جميع المدخلات المستلمة من المستخدم
3. **خصوصية البيانات**: تطبيق سياسة للوصول المشروط للبيانات حسب صلاحيات المستخدم
4. **جلسات آمنة**: إدارة الجلسات بطريقة آمنة لمنع هجمات اختطاف الجلسة

## واجهات API الداخلية

### واجهات البيانات الأساسية
- **`get_grades.php`**: جلب الصفوف الدراسية حسب المرحلة التعليمية
- **`get_sections.php`**: جلب الشعب الدراسية حسب الصف
- **`get_subjects.php`**: جلب المواد الدراسية حسب المدرسة (اختياري)
- **`get_teachers.php`**: جلب المعلمين حسب المدرسة والمادة ونوع الزائر
- **`get_visitor_name.php`**: جلب أسماء الزائرين حسب نوع الزائر

### واجهات الزيارات والتقييم
- **`get_previous_visits.php`**: جلب معلومات الزيارات السابقة للمعلم
- **`get_recommendations.php`**: جلب التوصيات الخاصة بمؤشر تقييم

## أدوات التطوير والاختبار

### بيئة التطوير
- **Laragon**: بيئة تطوير محلية (WAMP) لنظام ويندوز
- **VS Code**: محرر الأكواد مع إضافات PHP و Tailwind CSS
- **MySQL Workbench**: لإدارة قاعدة البيانات وتصميم النماذج

### آلية الاختبار
- اختبار الوحدات (Unit Testing) للوظائف الأساسية
- اختبار التكامل (Integration Testing) بين وحدات النظام
- اختبار الواجهة (UI Testing) للتأكد من تجربة مستخدم سلسة
- اختبار الأمان (Security Testing) لكشف الثغرات المحتملة

## المتطلبات التقنية للتشغيل

### متطلبات الخادم
- **نظام التشغيل**: Linux (Ubuntu/CentOS/Debian) أو Windows Server
- **خادم الويب**: Apache 2.4+ أو Nginx 1.18+
- **PHP**: الإصدار 7.4+ مع الإضافات:
  - PDO
  - mysqli
  - mbstring
  - gd
  - zip
  - session
- **MySQL**: الإصدار 5.7+ أو MariaDB 10.3+

### المتطلبات الفنية للمتصفح
- متصفح حديث يدعم HTML5 و CSS3:
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+
- تفعيل JavaScript
- دعم ملفات الكوكيز للحفاظ على الجلسة

### متطلبات الأداء
- **زمن الاستجابة**: أقل من 2 ثانية للصفحات العادية
- **معالجة متزامنة**: دعم لما لا يقل عن 50 مستخدم متزامن
- **مساحة تخزينية**: 500 ميجابايت لملفات النظام، زائد مساحة إضافية للمرفقات

## استراتيجية النسخ الاحتياطي
- **نسخ قاعدة البيانات**: جدولة نسخ احتياطي أسبوعي (أو يومي حسب الحاجة)
- **نسخ الملفات**: نسخ احتياطي للمرفقات والملفات المخصصة
- **استراتيجية الاحتفاظ**: الاحتفاظ بآخر 3 نسخ احتياطية على الأقل

## خطة تطوير النظام مستقبلاً
1. **ترحيل إلى إطار عمل حديث**: مثل Laravel أو CodeIgniter لتحسين بنية الشيفرة والأمان
2. **تطوير واجهة API كاملة**: لإتاحة التكامل مع الأنظمة الأخرى وتطوير تطبيقات موبايل
3. **تحسين الأداء**: استخدام التخزين المؤقت (Caching) وتحسين الاستعلامات
4. **أتمتة العمليات**: زيادة أتمتة التوصيات والتقارير باستخدام تقنيات الذكاء الاصطناعي
5. **تحسين واجهة المستخدم**: تطوير واجهة أكثر تفاعلية باستخدام أطر عمل JavaScript الحديثة 

## تحديثات مهمة

### مايو 2025
- تحسين واجهة المستخدم وإصلاح مشكلات القوائم المنسدلة
- إضافة مكتبة Alpine.js لتحسين تجربة المستخدم في عناصر التفاعل
- تنظيم وإعادة هيكلة القوائم الرئيسية لتسهيل الوصول إلى التقارير المختلفة
- إصلاح مشكلة في القائمة العلوية وإضافة ربط لتقارير أداء الصفوف والشعب 